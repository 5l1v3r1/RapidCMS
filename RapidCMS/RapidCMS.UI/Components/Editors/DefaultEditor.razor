@*
    // TODO: this should be made more nicer
    // TODO: this limits extensibility from outside
    // perhaps try https://docs.microsoft.com/en-us/aspnet/core/razor-components/components?view=aspnetcore-3.0#child-content

    // TODO: remove binding callback

    // TODO: change editor to accept complete Field / Property, instead of seperate parts
    // this wil make it a lot more dynamic
*@
@using RapidCMS.Common.Enums
@using RapidCMS.Common.Models.UI
@using RapidCMS.Common.Interfaces

@if (Field != null)
{   
    switch (Field.Type)
    {
        case EditorType.Readonly:

            <Readonly EditorValue="@Field.ReadonlyValue" />

            break;

        case EditorType.Numeric:

            <NumericEditor EditorValue="@((long)LocalValue)" Callback="ChildEditorCallback" />

            break;

        case EditorType.TextArea:

            <TextAreaEditor EditorValue="@((string)LocalValue)" Callback="ChildEditorCallback" />

            break;

        case EditorType.TextBox:
        default:

            <TextBoxEditor EditorValue="@((string)LocalValue)" Callback="ChildEditorCallback" />

            break;

        case EditorType.Select:

            <SelectEditor EditorValue="@((string)LocalValue)" Callback="ChildEditorCallback" DataProvider="Field.DataProvider" />

            break;

        case EditorType.MultiSelect:

            <MultiSelectEditor EditorValue="@((ICollection<string>)LocalValue)" Callback="ChildEditorCallback" DataProvider="Field.DataProvider" />

            break;

        case EditorType.Dropdown:

            <DropdownEditor EditorValue="@((string)LocalValue)" Callback="ChildEditorCallback" DataProvider="Field.DataProvider" />

            break;
    }
}

@functions {

#nullable enable

    [Parameter]
    private FieldUI? Field { get; set; }

    [Obsolete]
    [Parameter]
    private string Value { get; set; }

    public object? LocalValue
    {
        get
        {
            return Field?.Value;
        }
        set
        {
            if (Field != null)
            {
                Field.Value = value;
            }
        }
    }

    [Obsolete]
    [Parameter]
    private EditorType? Type { get; set; } = null;

    [Parameter]
    private Action<object>? Callback { get; set; }

    [Obsolete]
    [Parameter]
    private IDataProvider? DataProvider { get; set; }

    // TODO: this function is bullshit
    private void ChildEditorCallback<T>(T value)
    {
        LocalValue = (object?)value;

        Callback?.Invoke((object)value);
    }
}