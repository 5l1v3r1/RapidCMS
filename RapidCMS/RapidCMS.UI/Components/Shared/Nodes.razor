@inherits NodesBase

@inject ITreeService TreeService

@if (UI != null)
{
    <ul class="nav flex-column">
        @foreach (var node in UI)
        {
            <li class="nav-item">
                @if (node.Path != null)
                {
                    <NavLink href=@node.Path><i class="oi oi-minus"></i> @node.Name</NavLink>
                }
                else
                {
                    <a href="#" class="disabled"><i class="oi oi-lock-locked"></i> @node.Name</a>
                }

                <ul class="nav flex-column">
                    @foreach (var subCollection in node.Collections)
                    {
                        <Tree CollectionAlias=@subCollection ParentId=@node.Id />
                    }
                </ul>
            </li>
        }
    </ul>
}

@functions {

    List<TreeNodeUI>? UI;

    protected override async Task OnInitAsync()
    {
        UI = await TreeService.GetNodesAsync(CollectionAlias, ParentId, OnNodesUpdate);
    }

    [Parameter]
    private string CollectionAlias { get; set; }

    [Parameter]
    private string? ParentId { get; set; } = null;

    private void OnNodesUpdate()
    {

    }

    public override async Task HandleAsync(CollectionUpdatedMessage message)
    {
        // TODO: this causes UIThread issues in some cases

        if (message.CollectionAlias == CollectionAlias)
        {
            await OnInitAsync();
        }
    }
}
